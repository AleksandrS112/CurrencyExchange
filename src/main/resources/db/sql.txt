CREATE TABLE currencies
(
    id        SERIAL,
    code      VARCHAR(3)   NOT NULL,
    full_name VARCHAR(255) NOT NULL,
    sign      VARCHAR(3)   NOT NULL,
    CONSTRAINT currencies_pkey PRIMARY KEY (id),
    CONSTRAINT currencies_code_pk UNIQUE (code),
    CONSTRAINT length_code_check CHECK (LENGTH(code) = 3),
    CONSTRAINT length_full_name_check CHECK (LENGTH(full_name) <= 255),
    CONSTRAINT length_sign_check CHECK (LENGTH(sign) <= 3)
);

CREATE INDEX currencies_full_name_idx on currencies (full_name);
CREATE INDEX currencies_sign_idx on currencies (sign);

CREATE TABLE exchange_rates
(
    id                 SERIAL PRIMARY KEY,
    base_currency_id   INT REFERENCES currencies (id) NOT NULL ,
    target_currency_id INT REFERENCES currencies (id) NOT NULL ,
    rate               DECIMAL(6) NOT NULL,
    UNIQUE (base_currency_id, target_currency_id),
    CHECK (base_currency_id != target_currency_id)
)